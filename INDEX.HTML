<!-- Save this as index.html and open in your browser -->
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SpeakEasy ‚Äî Pro (30 Levels)</title>
<style>
  :root{
    --bg:#0f1724;
    --card:#0b1220;
    --accent:#06b6d4;
    --muted:#9aa4b2;
    --glass: rgba(255,255,255,0.03);
  }
  *{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial;}
  html,body{height:100%;margin:0;background:
    radial-gradient(1200px 600px at 10% 10%, rgba(6,182,212,0.06), transparent 10%),
    linear-gradient(180deg,var(--bg), #020617 180%);color:#e6eef6}
  .wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px;}
  .card{width:100%;max-width:980px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:22px;box-shadow:0 8px 30px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.03)}
  .header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
  .logo{display:flex;gap:12px;align-items:center}
  .logo .dot{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#7c3aed);display:flex;align-items:center;justify-content:center;font-weight:700}
  h1{font-size:18px;margin:0}
  .controls{display:flex;gap:10px;align-items:center}
  .btn{background:var(--accent);color:#012;padding:8px 12px;border-radius:8px;border:none;font-weight:600;cursor:pointer}
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
  .main{display:grid;grid-template-columns:1fr 320px;gap:18px}
  @media(max-width:880px){.main{grid-template-columns:1fr;}.right{order:2}}
  .panel{background:var(--card);padding:16px;border-radius:10px;border:1px solid rgba(255,255,255,0.02)}
  .center{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:320px;text-align:center;padding:22px}
  .input{width:100%;padding:10px;border-radius:8px;border:none;background:var(--glass);color:#e6eef6}
  .level-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;margin-top:12px}
  @media(max-width:720px){.level-grid{grid-template-columns:repeat(3,1fr)}}
  .level-card{padding:10px;border-radius:8px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));border:1px solid rgba(255,255,255,0.03);cursor:pointer; text-align:center}
  .level-card.locked{opacity:0.45;cursor:not-allowed;}
  .meta{font-size:13px;color:var(--muted);margin-top:8px}
  .question{font-size:18px;margin:12px 0;min-height:70px}
  .answer-input{width:100%;padding:12px;border-radius:8px;border:none;background:rgba(255,255,255,0.03);color:#eef;outline:none;font-size:16px}
  .timer{font-weight:700;font-size:16px}
  .small{font-size:13px;color:var(--muted)}
  .list{-webkit-overflow-scrolling:touch;overflow:auto;max-height:440px;padding-right:6px}
  .row{display:flex;align-items:center;justify-content:space-between;padding:8px 0;border-bottom:1px dashed rgba(255,255,255,0.02)}
  .success{color:#8ef3c1;font-weight:700}
  .fail{color:#ffb2b2;font-weight:700}
  .winner{background:linear-gradient(90deg,#0ea5a5 0%,#7c3aed 100%);padding:18px;border-radius:10px;color:#011; font-weight:800;text-align:center}
  footer{margin-top:12px;text-align:center;color:var(--muted);font-size:13px}
  .small-badge{font-size:12px;padding:4px 8px;border-radius:6px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03)}
  .progress-bar{height:8px;background:rgba(255,255,255,0.03);border-radius:8px;overflow:hidden}
  .progress{height:100%;background:linear-gradient(90deg,var(--accent),#7c3aed);width:0%}
  .hint{font-size:13px;color:var(--muted);margin-top:8px}
</style>
</head>
<body>
<div class="wrap">
  <div class="card" id="app">
    <div class="header">
      <div class="logo">
        <div class="dot">S</div>
        <div>
          <h1>SpeakEasy ‚Äî Pro</h1>
          <div class="small">30 Levels ‚Ä¢ Hindi ‚Üí English ‚Ä¢ Master Track</div>
        </div>
      </div>
      <div class="controls">
        <div id="user-name-display" class="small-badge" style="display:none"></div>
        <button class="btn ghost" id="resetBtn">Reset Progress</button>
      </div>
    </div>

    <div class="main">
      <div class="panel left">
        <!-- Dynamic content area -->
        <div id="contentArea">
          <!-- initial will be injected by JS -->
        </div>
      </div>

      <div class="panel right">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div class="small">Current Level</div>
            <div id="currentLevel" style="font-weight:800;font-size:22px">‚Äî</div>
          </div>
          <div style="text-align:right">
            <div class="small">Timer</div>
            <div class="timer" id="timerDisplay">00:00</div>
          </div>
        </div>

        <div style="margin-top:12px">
          <div class="small">Progress</div>
          <div class="progress-bar" style="margin-top:8px"><div id="progressFill" class="progress"></div></div>
          <div class="hint" id="progressText">0 / 30 completed</div>
        </div>

        <div style="margin-top:14px">
          <div class="small">Levels</div>
          <div class="level-grid" id="levelsList" style="margin-top:8px"></div>
        </div>

        <div style="margin-top:12px">
          <div class="small">Recent Activity</div>
          <div class="list" id="recentList" style="margin-top:8px">
            <!-- recent rows -->
          </div>
        </div>
      </div>
    </div>

    <footer>Made with ‚ù§Ô∏è ‚Äî  Vicky bhelave                          ‚Ä¢  SpeakEasy - Pro  Levels: 1‚Äì30</footer>
  </div>
</div>

<script>
/* ========= SpeakEasy ‚Äî Pro (Single-file JS) =========
   Features implemented:
   - 30 levels with sample Hindi prompts and English answers
   - Timer per level (default 60s for words, 90s for sentences, 180s for paragraphs)
   - Unlock system, per-level time-tracking, localStorage persistence
   - Winner banner at completion showing user's name and total time
*/

// ---------- Data: 30 level items (prompt in Hindi, expected English answer) ----------
const LEVELS = [
  // Levels 1-10: words (Hindi -> English single word)
  {type:'word', q:'‡§®‡§Æ‡§∏‡•ç‡§§‡•á', a:'Hello'},
  {type:'word', q:'‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶', a:'Thank you'},
  {type:'word', q:'‡§™‡§æ‡§®‡•Ä', a:'Water'},
  {type:'word', q:'‡§ò‡§∞', a:'House'},
  {type:'word', q:'‡§ï‡§ø‡§§‡§æ‡§¨', a:'Book'},
  {type:'word', q:'‡§∏‡•ç‡§ï‡•Ç‡§≤', a:'School'},
  {type:'word', q:'‡§¶‡•ã‡§∏‡•ç‡§§', a:'Friend'},
  {type:'word', q:'‡§≠‡•ã‡§ú‡§®', a:'Food'},
  {type:'word', q:'‡§∏‡•Ç‡§∞‡§ú', a:'Sun'},
  {type:'word', q:'‡§∞‡§æ‡§§', a:'Night'},

  // Levels 11-20: sentences
  {type:'sentence', q:'‡§Æ‡•Å‡§ù‡•á ‡§è‡§ï ‡§ï‡§™ ‡§ö‡§æ‡§Ø ‡§ö‡§æ‡§π‡§ø‡§è‡•§', a:'I need a cup of tea.'},
  {type:'sentence', q:'‡§µ‡§π ‡§¨‡§æ‡§ú‡§æ‡§∞ ‡§ú‡§æ ‡§∞‡§π‡§æ ‡§π‡•à‡•§', a:'He is going to the market.'},
  {type:'sentence', q:'‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§Æ‡•á‡§∞‡•Ä ‡§Æ‡§¶‡§¶ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç?', a:'Can you help me?'},
  {type:'sentence', q:'‡§Ø‡§π ‡§¨‡§π‡•Å‡§§ ‡§Æ‡§π‡§Ç‡§ó‡§æ ‡§π‡•à‡•§', a:'This is very expensive.'},
  {type:'sentence', q:'‡§Æ‡•Å‡§ù‡•á ‡§Ö‡§Ç‡§ó‡•ç‡§∞‡•á‡§ú‡•Ä ‡§∏‡•Ä‡§ñ‡§®‡•Ä ‡§π‡•à‡•§', a:'I want to learn English.'},
  {type:'sentence', q:'‡§ï‡•É‡§™‡§Ø‡§æ ‡§¶‡§∞‡§µ‡§æ‡§ú‡§æ ‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•ã‡•§', a:'Please close the door.'},
  {type:'sentence', q:'‡§Æ‡•à‡§Ç ‡§ï‡§≤ ‡§¶‡§ø‡§≤‡•ç‡§≤‡•Ä ‡§ú‡§æ‡§ä‡§Ç‡§ó‡§æ‡•§', a:'I will go to Delhi tomorrow.'},
  {type:'sentence', q:'‡§µ‡§π ‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§¨‡•ã‡§≤‡§§‡•Ä ‡§π‡•à‡•§', a:'She speaks Hindi.'},
  {type:'sentence', q:'‡§Æ‡•Å‡§ù‡•á ‡§∏‡§Æ‡§ù ‡§®‡§π‡•Ä‡§Ç ‡§Ü‡§Ø‡§æ‡•§', a:'I did not understand.'},
  {type:'sentence', q:'‡§µ‡•á ‡§¨‡§π‡•Å‡§§ ‡§ñ‡•Å‡§∂ ‡§π‡•à‡§Ç‡•§', a:'They are very happy.'},

  // Levels 21-30: paragraphs (short)
  {type:'paragraph', q:'‡§Æ‡•à‡§Ç ‡§π‡§∞ ‡§∏‡•Å‡§¨‡§π ‡§ú‡§≤‡•ç‡§¶‡•Ä ‡§â‡§†‡§§‡§æ ‡§π‡•Ç‡§Å ‡§î‡§∞ ‡§∏‡•à‡§∞ ‡§™‡§∞ ‡§ú‡§æ‡§§‡§æ ‡§π‡•Ç‡§Å‡•§ ‡§á‡§∏‡§∏‡•á ‡§Æ‡•á‡§∞‡§æ ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§Ö‡§ö‡•ç‡§õ‡§æ ‡§∞‡§π‡§§‡§æ ‡§π‡•à‡•§', a:'I wake up early every morning and go for a walk. It keeps my health good.'},
  {type:'paragraph', q:'‡§Æ‡•á‡§∞‡•Ä ‡§Æ‡§æ‡§Å ‡§Ö‡§ö‡•ç‡§õ‡•Ä ‡§∞‡§∏‡•ã‡§á‡§Ø‡§æ ‡§π‡•à‡§Ç‡•§ ‡§µ‡§π ‡§π‡§∞ ‡§¶‡§ø‡§® ‡§∏‡•ç‡§µ‡§æ‡§¶‡§ø‡§∑‡•ç‡§ü ‡§≠‡•ã‡§ú‡§® ‡§¨‡§®‡§æ‡§§‡•Ä ‡§π‡•à‡§Ç ‡§î‡§∞ ‡§π‡§Æ ‡§∏‡§¨ ‡§â‡§®‡§ï‡§æ ‡§Ü‡§≠‡§æ‡§∞ ‡§Æ‡§π‡§∏‡•Ç‡§∏ ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç‡•§', a:'My mother is a good cook. She prepares delicious food every day and we all feel grateful to her.'},
  {type:'paragraph', q:'‡§π‡§Æ‡§æ‡§∞‡•á ‡§∏‡•ç‡§ï‡•Ç‡§≤ ‡§Æ‡•á‡§Ç ‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§® ‡§™‡•ç‡§∞‡§Ø‡•ã‡§ó‡§∂‡§æ‡§≤‡§æ ‡§¨‡§π‡•Å‡§§ ‡§Ö‡§ö‡•ç‡§õ‡•Ä ‡§π‡•à‡•§ ‡§µ‡§π‡§æ‡§Å ‡§™‡•ç‡§∞‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á ‡§õ‡§æ‡§§‡•ç‡§∞‡•ã‡§Ç ‡§ï‡•ã ‡§∏‡•Ä‡§ñ‡§®‡•á ‡§Æ‡•á‡§Ç ‡§Æ‡§ú‡§º‡§æ ‡§Ü‡§§‡§æ ‡§π‡•à‡•§', a:'Our school has a very good science laboratory. Doing experiments there makes learning enjoyable for students.'},
  {type:'paragraph', q:'‡§ü‡§ø‡§ï‡§ü ‡§ñ‡§∞‡•Ä‡§¶‡§®‡•á ‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§π‡§Æ‡•á‡§Ç ‡§∏‡•ç‡§ü‡•á‡§∂‡§® ‡§™‡§∞ ‡§ú‡§≤‡•ç‡§¶‡•Ä ‡§™‡§π‡•Å‡§Å‡§ö‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è ‡§§‡§æ‡§ï‡§ø ‡§∏‡•Ä‡§ü ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§∞‡§π‡•á‡•§', a:'After buying the ticket we should reach the station early so that the seat remains secure.'},
  {type:'paragraph', q:'‡§™‡•ç‡§∞‡•å‡§¶‡•ç‡§Ø‡•ã‡§ó‡§ø‡§ï‡•Ä ‡§®‡•á ‡§π‡§Æ‡§æ‡§∞‡•á ‡§ú‡•Ä‡§µ‡§® ‡§ï‡•ã ‡§∏‡§∞‡§≤ ‡§ï‡§∞ ‡§¶‡§ø‡§Ø‡§æ ‡§π‡•à; ‡§π‡§Æ ‡§¶‡•Ç‡§∞ ‡§¨‡•à‡§†‡•á ‡§π‡•Å‡§è ‡§≠‡•Ä ‡§¨‡§π‡•Å‡§§ ‡§ï‡§æ‡§Æ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§', a:'Technology has made our lives simple; we can do a lot of work while sitting far away.'},
  {type:'paragraph', q:'‡§™‡§∞‡•ç‡§Ø‡§æ‡§µ‡§∞‡§£ ‡§ï‡•Ä ‡§∞‡§ï‡•ç‡§∑‡§æ ‡§ï‡§∞‡§®‡§æ ‡§π‡§Æ ‡§∏‡§¨‡§ï‡•Ä ‡§ú‡§ø‡§Æ‡•ç‡§Æ‡•á‡§¶‡§æ‡§∞‡•Ä ‡§π‡•à‡•§ ‡§™‡•á‡§°‡§º ‡§≤‡§ó‡§æ‡§®‡§æ ‡§î‡§∞ ‡§™‡§æ‡§®‡•Ä ‡§¨‡§ö‡§æ‡§®‡§æ ‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§π‡•à‡•§', a:'Protecting the environment is everyone‚Äôs responsibility. Planting trees and saving water are important.'},
  {type:'paragraph', q:'‡§è‡§ï ‡§Ö‡§ö‡•ç‡§õ‡•Ä ‡§Ü‡§¶‡§§ ‡§ß‡•Ä‡§∞‡•á-‡§ß‡•Ä‡§∞‡•á ‡§¨‡§®‡§§‡•Ä ‡§π‡•à‡•§ ‡§õ‡•ã‡§ü‡•á-‡§õ‡•ã‡§ü‡•á ‡§ï‡§¶‡§Æ ‡§â‡§†‡§æ‡§ï‡§∞ ‡§Ü‡§™ ‡§¨‡§°‡§º‡•Ä ‡§∏‡§´‡§≤‡§§‡§æ ‡§™‡§æ‡§§‡•á ‡§π‡•à‡§Ç‡•§', a:'A good habit builds slowly. By taking small steps you achieve great success.'},
  {type:'paragraph', q:'‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§ï‡§∞‡§§‡•á ‡§∏‡§Æ‡§Ø ‡§π‡§Æ‡•á‡§Ç ‡§∏‡•ç‡§•‡§æ‡§®‡•Ä‡§Ø ‡§∏‡§Ç‡§∏‡•ç‡§ï‡•É‡§§‡§ø ‡§ï‡§æ ‡§∏‡§Æ‡•ç‡§Æ‡§æ‡§® ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è ‡§î‡§∞ ‡§ú‡§ó‡§π ‡§ï‡•ã ‡§∏‡§æ‡§´ ‡§∞‡§ñ‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è‡•§', a:'While traveling we should respect the local culture and keep the place clean.'},
  {type:'paragraph', q:'‡§ï‡§†‡§ø‡§®‡§æ‡§à ‡§ï‡•á ‡§∏‡§Æ‡§Ø ‡§Æ‡•á‡§Ç ‡§ß‡•à‡§∞‡•ç‡§Ø ‡§¨‡§®‡§æ‡§è ‡§∞‡§ñ‡§®‡§æ ‡§î‡§∞ ‡§Æ‡•á‡§π‡§®‡§§ ‡§ï‡§∞‡§®‡§æ ‡§π‡•Ä ‡§∏‡§´‡§≤‡§§‡§æ ‡§ï‡•Ä ‡§ï‡•Å‡§Ç‡§ú‡•Ä ‡§π‡•à‡•§', a:'In times of difficulty, keeping patience and working hard is the key to success.'},
  {type:'paragraph', q:'‡§è‡§ï ‡§Ö‡§ö‡•ç‡§õ‡§æ ‡§®‡•á‡§§‡§æ ‡§µ‡§π ‡§π‡•à ‡§ú‡•ã ‡§≤‡•ã‡§ó‡•ã‡§Ç ‡§ï‡•Ä ‡§∏‡•Å‡§®‡§§‡§æ ‡§π‡•à, ‡§∏‡§Æ‡§ù‡§§‡§æ ‡§π‡•à ‡§î‡§∞ ‡§â‡§®‡•ç‡§π‡•á‡§Ç ‡§Ü‡§ó‡•á ‡§¨‡§¢‡§º‡§®‡•á ‡§Æ‡•á‡§Ç ‡§Æ‡§¶‡§¶ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§', a:'A good leader is one who listens to people, understands them, and helps them move forward.'}
];

// ---------- Configuration ----------
const DEFAULT_TIMERS = { word:60, sentence:90, paragraph:180 }; // seconds

// ---------- State ----------
let state = {
  name: null,
  currentLevel: 1,
  completed: {}, // level -> {timeTaken, correct, answerGiven}
  levelStartAt: null,
  timerRemaining: 0,
  timerInterval: null
};

// ---------- Persistence ----------
const STORAGE_KEY = 'speakeasy_pro_v1';

function loadState(){
  const raw = localStorage.getItem(STORAGE_KEY);
  if(raw){
    try{
      const parsed = JSON.parse(raw);
      state = {...state, ...parsed};
    }catch(e){ console.warn('loadState parse err', e); }
  }
}
function saveState(){
  const toSave = {
    name: state.name,
    currentLevel: state.currentLevel,
    completed: state.completed
  };
  localStorage.setItem(STORAGE_KEY, JSON.stringify(toSave));
}

// ---------- Utilities ----------
function secsToMMSS(s){
  s = Math.max(0, Math.floor(s));
  const mm = String(Math.floor(s/60)).padStart(2,'0');
  const ss = String(s%60).padStart(2,'0');
  return `${mm}:${ss}`;
}
function clamp(v,min,max){ return Math.max(min,Math.min(max,v)); }

// ---------- UI Rendering ----------
const contentArea = document.getElementById('contentArea');
const currentLevelEl = document.getElementById('currentLevel');
const levelsListEl = document.getElementById('levelsList');
const recentListEl = document.getElementById('recentList');
const timerDisplay = document.getElementById('timerDisplay');
const userNameDisplay = document.getElementById('user-name-display');
const progressFill = document.getElementById('progressFill');
const progressText = document.getElementById('progressText');
const resetBtn = document.getElementById('resetBtn');

resetBtn.addEventListener('click', ()=> {
  if(!confirm('Are you sure? This will clear progress.')) return;
  localStorage.removeItem(STORAGE_KEY);
  location.reload();
});

function renderApp(){
  // header name
  if(state.name){ userNameDisplay.style.display='inline-block'; userNameDisplay.textContent = 'Hi, ' + state.name; } else { userNameDisplay.style.display='none'; }

  // left content: if no name -> show name input
  if(!state.name){
    renderNameInput();
  } else {
    // if completed all levels -> show winner
    if(state.currentLevel > LEVELS.length){
      renderWinner();
    } else {
      renderLevelView(state.currentLevel);
    }
  }

  renderLevelsList();
  renderRecent();
  renderProgress();
  currentLevelEl.textContent = state.currentLevel <= LEVELS.length ? `Level ${state.currentLevel}` : '‚Äî';
}

function renderNameInput(){
  contentArea.innerHTML = `
    <div class="center">
      <h2>Welcome to SpeakEasy ‚Äî Pro</h2>
      <p class="small" style="margin-top:8px">Enter your name to start the 30-level challenge.</p>
      <div style="width:100%;max-width:420px;margin-top:14px">
        <input id="nameInput" class="input" placeholder="Enter your name (e.g., Rahul)" />
        <div style="display:flex;gap:8px;margin-top:12px;justify-content:center">
          <button class="btn" id="startBtn">Start</button>
        </div>
        <p class="hint">Your progress will be saved locally in this browser.</p>
      </div>
    </div>
  `;
  document.getElementById('startBtn').addEventListener('click', ()=> {
    const nm = document.getElementById('nameInput').value.trim();
    if(!nm){ alert('Please enter a name'); return; }
    state.name = nm;
    saveState();
    renderApp();
  });
}

function renderLevelView(levelIndex){
  const idx = levelIndex-1;
  const item = LEVELS[idx];
  const timerSec = DEFAULT_TIMERS[item.type] || 90;
  // layout
  contentArea.innerHTML = `
    <div>
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div class="small">Level ${levelIndex} ‚Äî ${item.type.toUpperCase()}</div>
          <div style="font-weight:800;font-size:20px;margin-top:6px">Translate to English</div>
        </div>
        <div style="text-align:right">
          <div class="small">Best of Luck</div>
          <div class="small">Name: <strong>${escapeHtml(state.name)}</strong></div>
        </div>
      </div>

      <div style="margin-top:16px" class="panel">
        <div class="question">${escapeHtml(item.q)}</div>
        <input id="answerInput" class="answer-input" placeholder="Type your English translation here..." autocomplete="off" />
        <div style="display:flex;gap:8px;margin-top:12px;align-items:center;justify-content:space-between">
          <div>
            <button class="btn" id="submitBtn">Submit</button>
            <button class="btn ghost" id="skipBtn">Skip</button>
            <button class="btn ghost" id="hintBtn">Show Answer (forfeit)</button>
          </div>
          <div class="small">
            Timer: <span id="levelTimer">${secsToMMSS(timerSec)}</span>
          </div>
        </div>
        <p class="hint">Type the exact answer or a close match (case-insensitive). Use "Show Answer" to forfeit and mark level complete.</p>
      </div>
    </div>
  `;

  // prepare timer state
  stopTimer();
  state.levelStartAt = Date.now();
  state.timerRemaining = timerSec;
  updateTimerDisplay();
  startTimer(()=> { // on timeout
    // auto-handle as failed
    handleSubmit(true, true); // timed out + auto
  });

  // focus input
  document.getElementById('answerInput').focus();

  // event handlers
  document.getElementById('submitBtn').addEventListener('click', ()=> handleSubmit(false,false));
  document.getElementById('skipBtn').addEventListener('click', ()=> {
    if(!confirm('Skip this level? You will mark it as failed.')) return;
    handleSubmit(true,false);
  });
  document.getElementById('hintBtn').addEventListener('click', ()=> {
    if(!confirm('Showing answer will mark this level completed but as forfeited. Continue?')) return;
    // show correct answer then mark completed (forfeit)
    alert('Answer: ' + LEVELS[idx].a);
    handleSubmit(true,false,true);
  });

  function handleSubmit(markFailed, timedOut, forceForfeit){
    // stop timer
    stopTimer();
    const answerGiven = (document.getElementById('answerInput') || {}).value || '';
    const correctAnswer = LEVELS[idx].a;
    const normalizedGiven = normalize(answerGiven);
    const normalizedCorrect = normalize(correctAnswer);
    const timeTaken = Math.round((Date.now() - state.levelStartAt)/1000);
    // check correctness: accept case-insensitive and allow small differences
    const similarity = stringSimilarity(normalizedGiven, normalizedCorrect);
    const accepted = (!markFailed && (similarity >= 0.65 || normalizedGiven === normalizedCorrect));
    const record = {
      timeTaken: timeTaken,
      correct: accepted && !forceForfeit && !timedOut,
      answerGiven: answerGiven,
      timedOut: Boolean(timedOut),
      forfeited: Boolean(forceForfeit),
      similarity: Math.round(similarity*100)/100
    };
    state.completed[levelIndex] = record;
    // advance
    state.currentLevel = Math.min(LEVELS.length+1, state.currentLevel + 1);
    saveState();
    renderFeedback(levelIndex, record);
    renderApp(); // update right panel/levels/progress
  }
}

function renderFeedback(levelIndex, record){
  // show a small modal-like feedback in content area briefly
  const correctText = record.correct ? '<span class="success">Correct</span>' : '<span class="fail">Not correct / Forfeited</span>';
  contentArea.innerHTML = `
    <div class="center">
      <div style="max-width:720px">
        <div style="font-size:20px;font-weight:800">Level ${levelIndex} Completed</div>
        <div class="meta" style="margin-top:10px">Time taken: <strong>${record.timeTaken}s</strong></div>
        <div style="margin-top:8px">Result: ${correctText}</div>
        <div class="hint" style="margin-top:10px">Your answer: "${escapeHtml(record.answerGiven || '‚Äî')}" ‚Ä¢ similarity: ${record.similarity}</div>
        <div style="margin-top:14px;display:flex;gap:8px;justify-content:center">
          <button class="btn" id="nextBtn">Continue</button>
          <button class="btn ghost" id="viewProgressBtn">View Progress</button>
        </div>
      </div>
    </div>
  `;
  document.getElementById('nextBtn').addEventListener('click', ()=> renderApp());
  document.getElementById('viewProgressBtn').addEventListener('click', ()=> { /* keep on same */ renderApp(); });
}

function renderWinner(){
  // calculate total time
  let total = 0; let correctCount = 0;
  for(let i=1;i<=LEVELS.length;i++){
    const r = state.completed[i];
    if(r){ total += (r.timeTaken || 0); if(r.correct) correctCount++; }
  }
  const avg = (total / LEVELS.length).toFixed(1);
  contentArea.innerHTML = `
    <div class="center">
      <div class="winner">
        üéâ Congratulations, ${escapeHtml(state.name)}! üéâ
      </div>
      <div style="margin-top:14px;font-weight:700;font-size:18px">You completed all ${LEVELS.length} levels</div>
      <div style="margin-top:8px" class="meta">Total time: <strong>${total}s</strong> ‚Ä¢ Average per level: <strong>${avg}s</strong></div>
      <div style="margin-top:10px" class="small">Correct answers: <strong>${correctCount}</strong> / ${LEVELS.length}</div>
      <div style="margin-top:16px;display:flex;gap:10px;justify-content:center">
        <button class="btn" id="reviewBtn">Review All Answers</button>
        <button class="btn ghost" id="restartBtn">Restart (Reset progress)</button>
      </div>
    </div>
  `;
  document.getElementById('reviewBtn').addEventListener('click', ()=> renderReview());
  document.getElementById('restartBtn').addEventListener('click', ()=> {
    if(!confirm('Reset all progress and start again?')) return;
    localStorage.removeItem(STORAGE_KEY);
    location.reload();
  });
}

function renderReview(){
  // show a list of all levels with answers and user's attempt
  let html = '<div style="padding:8px"><h3>Review ‚Äî All Levels</h3>';
  html += '<div class="list" style="max-height:520px;margin-top:8px">';
  for(let i=1;i<=LEVELS.length;i++){
    const l = LEVELS[i-1];
    const r = state.completed[i];
    html += `<div class="row"><div style="flex:1">
      <div style="font-weight:700">Level ${i} ‚Ä¢ ${l.type}</div>
      <div class="small" style="margin-top:4px">Q: ${escapeHtml(l.q)}</div>
      <div class="small" style="margin-top:4px">Correct: ${escapeHtml(l.a)}</div>
      <div class="small" style="margin-top:6px">Your answer: ${escapeHtml((r && r.answerGiven) || '‚Äî')}</div>
    </div>
    <div style="width:140px;text-align:right">
      <div class="${r && r.correct ? 'success' : 'fail'}">${r && r.correct ? 'Correct' : 'Not/Forfeit'}</div>
      <div class="small" style="margin-top:6px">${r ? r.timeTaken + 's' : '--'}</div>
    </div></div>`;
  }
  html += '</div><div style="margin-top:12px;display:flex;gap:8px;justify-content:center"><button class="btn" id="backBtn">Back</button></div></div>';
  contentArea.innerHTML = html;
  document.getElementById('backBtn').addEventListener('click', ()=> renderApp());
}

// ---------- Right panel renders ----------
function renderLevelsList(){
  levelsListEl.innerHTML = '';
  for(let i=1;i<=LEVELS.length;i++){
    const isLocked = i > state.currentLevel;
    const el = document.createElement('div');
    el.className = 'level-card ' + (isLocked? 'locked':'');
    el.innerHTML = `<div style="font-weight:700">L ${i}</div><div class="small">${LEVELS[i-1].type}</div>`;
    el.addEventListener('click', ()=> {
      if(isLocked){ alert('This level is locked. Complete previous levels to unlock.'); return; }
      // go to that level
      state.currentLevel = i;
      saveState();
      renderApp();
    });
    levelsListEl.appendChild(el);
  }
}

function renderRecent(){
  recentListEl.innerHTML = '';
  const entries = Object.entries(state.completed).sort((a,b)=> b[0]-a[0]).slice(0,6); // latest 6
  if(entries.length===0){
    recentListEl.innerHTML = '<div class="small">No recent activity yet.</div>';
    return;
  }
  entries.forEach(([lvl,rec])=>{
    const row = document.createElement('div'); row.className='row';
    row.innerHTML = `<div style="flex:1"><div style="font-weight:700">Level ${lvl}</div><div class="small">${rec.answerGiven || '‚Äî'}</div></div>
      <div style="text-align:right"><div class="${rec.correct ? 'success':'fail'}">${rec.correct ? 'Correct' : (rec.forfeited ? 'Forfeit' : rec.timedOut ? 'Timed out':'Wrong')}</div><div class="small">${rec.timeTaken}s</div></div>`;
    recentListEl.appendChild(row);
  });
}

function renderProgress(){
  const done = Object.keys(state.completed).length;
  const pct = Math.round((done / LEVELS.length) * 100);
  progressFill.style.width = pct + '%';
  progressText.textContent = `${done} / ${LEVELS.length} completed ‚Ä¢ ${pct}%`;
}

// ---------- Timer functions ----------
function startTimer(onTimeout){
  stopTimer();
  updateTimerDisplay();
  state.timerInterval = setInterval(()=>{
    state.timerRemaining--;
    if(state.timerRemaining <= 0){
      stopTimer();
      timerDisplay.textContent = '00:00';
      if(typeof onTimeout === 'function') onTimeout();
      return;
    }
    updateTimerDisplay();
  }, 1000);
}
function stopTimer(){ if(state.timerInterval){ clearInterval(state.timerInterval); state.timerInterval = null; } }
function updateTimerDisplay(){
  timerDisplay.textContent = secsToMMSS(state.timerRemaining || 0);
  const el = document.getElementById('levelTimer');
  if(el) el.textContent = secsToMMSS(state.timerRemaining || 0);
}

// ---------- Helpers ----------
function escapeHtml(str){
  if(!str) return '';
  return String(str).replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[s]));
}
function normalize(s){
  return String(s||'').toLowerCase().trim().replace(/[^\w\s]/g,'').replace(/\s+/g,' ');
}
function stringSimilarity(s1,s2){
  // simple Jaccard on words + character overlap hybrid
  if(!s1 && !s2) return 1;
  if(!s1 || !s2) return 0;
  const w1 = new Set(s1.split(' '));
  const w2 = new Set(s2.split(' '));
  const inter = [...w1].filter(x=>w2.has(x)).length;
  const union = new Set([...w1,...w2]).size || 1;
  const jaccard = inter/union;
  // char overlap
  const chars1 = new Set(s1), chars2 = new Set(s2);
  const cinter = [...chars1].filter(x=>chars2.has(x)).length;
  const cunion = new Set([...chars1,...chars2]).size || 1;
  const cscore = cinter / cunion;
  return (jaccard * 0.7) + (cscore * 0.3);
}

// ---------- Init ----------
function init(){
  loadState();
  // if currentLevel stored but some levels missing, clamp
  state.currentLevel = Math.max(1, Math.min(LEVELS.length+1, state.currentLevel || 1));
  // if there is a current incomplete level, set timerRemaining accordingly; else default for current level
  if(state.currentLevel <= LEVELS.length){
    const it = LEVELS[state.currentLevel-1];
    state.timerRemaining = DEFAULT_TIMERS[it.type];
  }
  renderApp();
}

// ---------- Start ----------
init();

</script>
</body>
</html>


















